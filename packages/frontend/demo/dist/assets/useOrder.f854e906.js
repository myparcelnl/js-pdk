var y=Object.defineProperty;var w=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var n=(s,e,t)=>(w(s,typeof e!="symbol"?e+"":e,t),t);import{s as p,e as l,I as O,a as E,l as g,u as b,b as x}from"./boot.e272cece.js";import{c as T,r as P}from"./index.aeebef3f.js";const j=s=>{var r,a,o;if(!p(s,l))throw new Error(`Key ${s} is not a valid instance context key.`);const e=T(O),t=(r=e==null?void 0:e.context)==null?void 0:r[s];if(!t){const d=Object.keys((a=e==null?void 0:e.context)!=null?a:{}).join(", "),c=(o=e==null?void 0:e.component)!=null?o:"UNKNOWN";throw console.log(c,d),E(`The component "${c}" requires the context "${s}". Available: ${d}`),new Error(`Failed to render "${c}"`)}return t},C=s=>{let e;return p(s,l)?e=j(s):e=s,e||g("Failed to get context object."),e},H=s=>{var r;return{...(r=b().context.orderData)==null?void 0:r.find(a=>a.externalIdentifier===s[1])}};class m extends Error{constructor(t){super(t.message);n(this,"data");Object.setPrototypeOf(this,m.prototype),this.name="ApiException",this.data=t}}class h extends Error{constructor(t){super(t);n(this,"name","user");Object.setPrototypeOf(this,h.prototype),this.name="UserException"}}const f=(s,e)=>{if(e){const t=Object.entries(e).map(([r,a])=>`${r}=${a}`);t.length&&(s+=`?${t.join("&")}`)}return s};function i(s,e){return s&&s[e]!==void 0}const $="https://api.myparcel.nl",q=["POST","PUT"];class S{constructor(e){n(this,"baseUrl");n(this,"headers");n(this,"parameters");n(this,"options");n(this,"_requiredHeaders",[]);var t,r,a,o;this.baseUrl=((t=e==null?void 0:e.baseUrl)!=null?t:$).replace(/\/+$/,""),this.headers=(r=e==null?void 0:e.headers)!=null?r:{},this.parameters=(a=e==null?void 0:e.parameters)!=null?a:{},this.options=(o=e==null?void 0:e.options)!=null?o:{}}get requiredHeaders(){return this._requiredHeaders}set requiredHeaders(e){this._requiredHeaders=e}async doRequest(e,t){const r=this.normalizeOptions(e,{...t,...this.options});this.validateHeaders(e,r);const a=await this.request(e,r);if(i(a,"errors"))throw new m(a);return i(a,"data")?a.data[e.getResponseProperty()]:a}getHeaders(){return{Accept:"application/json",...this.headers}}createUrl(e,t){let r=e.getPath();if(r.length&&!r.startsWith("/")&&(r=`/${r}`),t!=null&&t.path&&(r=this.substitutePath(r,t.path)),r.includes("/:"))throw new h(`One or more path variables are missing in ${r}`);return t!=null&&t.parameters&&(r=f(r,t.parameters)),this.baseUrl+r}substitutePath(e,t){if(t&&Object.entries(t).forEach(([r,a])=>{e=e.replace(`:${r}`,String(a))}),e.includes(":")){const r=e.match(/:\w+?\?/g);r==null||r.forEach(a=>{e=e.replace(`/${a}`,"")})}return e}validateHeaders(e,t){const r=Object.entries(t.headers).reduce((o,[d,c])=>({...o,[d.toLowerCase()]:c}),{}),a=this.requiredHeaders.filter(o=>!(o.toLowerCase()in r));if(a.length)throw new h(`Required headers are missing: ${a.join(", ")}`)}normalizeOptions(e,t){const r={...t,parameters:{...this.parameters,...t.parameters,...e.getParameters()},headers:{...q.includes(e.method)?{"Content-Type":"application/json"}:{},...this.getHeaders(),...t.headers,...e.getHeaders()}};return i(t,"body")&&(r.body={data:{[e.getProperty()]:t.body}}),r}}class U extends S{constructor(){super(...arguments);n(this,"request",async(t,r)=>{var u;const a=new AbortController,o=setTimeout(()=>a.abort(),r.timeout),d={method:t.method,headers:r.headers,...r.timeout&&{signal:a.signal}};i(r,"body")&&(d.body=JSON.stringify(r.body));const c=await fetch(this.createUrl(t,r),d);if(clearTimeout(o),c.body)return(u=c.headers.get("Content-Type"))!=null&&u.includes("application/json")?c.json():c.text()})}}class A{constructor(e){n(this,"method","GET");n(this,"responseProperty");n(this,"headers");n(this,"parameters");var t,r;this.headers=(t=e==null?void 0:e.headers)!=null?t:{},this.parameters=(r=e==null?void 0:e.parameters)!=null?r:{}}getHeaders(){return this.headers}getParameters(){return this.parameters}getPath(){return this.path}getProperty(){return this.property}getResponseProperty(){var e;return(e=this.responseProperty)!=null?e:this.property}}function N(s,e){if(!e.length)throw new h("At least one endpoint must be passed.");return e.reduce((t,r)=>({...t,[r.name]:async a=>s.doRequest(r,a!=null?a:{})}),{})}class v extends A{constructor(){super(...arguments);n(this,"name")}}const D=()=>{var r,a;const s=b(),e=(r=s.context.global)==null?void 0:r.endpoints;if(!e)throw new Error;const t=Object.entries(e).map(([o,d])=>{class c extends v{constructor(){super(...arguments);n(this,"name",o);n(this,"method",d.httpMethod.toUpperCase());n(this,"property","data");n(this,"path",d.path)}}return new c({headers:d.headers,parameters:d.parameters})});return N(new U({baseUrl:(a=s.context.global)==null?void 0:a.baseUrl}),t)},F=s=>{const e=P(s!=null?s:C(l.ORDER_IDENTIFIER)),t=["order",e.value];return x(t,async()=>{const r=D(),a={parameters:{orderIds:e.value}};return r.getOrderData(a)},{enabled:Boolean(e.value),initialData:H(t)})};export{C as a,D as b,F as u};
